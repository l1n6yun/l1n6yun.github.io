title: '小程序之缓存类 '
author: l1n6yun
tags: 
 - JavaScript
 - 小程序
 - 前端开发
 - 性能优化
categories: []
date: 2020-01-17 00:33:03
---
其实，小程序自带了缓存接口，有同步 `wx.setStorageSync` ，异步 `wx.setStorage` 的方法，但是实际在使用缓存的场景里，我们一般都是需要设置缓存有效时间的，本cache工具就是对小程序缓存接口的封装，实现了对缓存有效期的支持。

```js
module.exports = {
  test: function() {
    try {
      wx.setStorageSync("JDC_TEST", "1");
      wx.removeStorageSync("JDC_TEST");
      return true;
    } catch (e) {
      wx.showModal({
        title: "提示",
        content: "小程序缓存出现问题,请稍后使用",
        showCancel: !1,
        success: function(e) {
          if(e.confirm){
              console.log("用户点击确定");
          }
        }
      })
      return false;
    }
  },
  set: function(name, value, expire) {
    if (typeof expire == "number") {
      expire = expire * 1e3;
    } else {
      expire = 2592e5
    }
    wx.removeStorageSync(name);
    var time = new Date().getTime();
    try {
      wx.setStorageSync(name, {
        _value: value,
        _time: time,
        _age: time + expire
      });
      return true;
    } catch (e) {
      return false;
    }
  },
  get: function(name) {
    var data = this._isExpire(name);
    if (data !== true) {
      return data._value
    } else {
      return null
    }
  },
  del: function(name) {
    try {
      wx.removeStorageSync(name);
      return !0;
    } catch (e) {
      return !1;
    }
  },
  _isExpire: function(name) {
    var data = wx.getStorageSync(name);
    var time = new Date().getTime();
    if (data && time < data._age) {
      return data;
    } else {
      return true;
    }
  },
}
```

```js
import cache from '../utils/cache.js'

cache.set("key","value",7200);
cache.get("key");
cache.del("key");
```